<!DOCTYPE html>
<html>
<head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.9.0/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>{{title}} - Swagger UI</title>
    <style>
        /* 自定义样式 */
        .swagger-ui .info .title {
            color: #3b4151;
        }
        /* 隐藏 Swagger UI 的默认授权文本 */
        .swagger-ui .auth-wrapper .auth-container .auth-btn-wrapper .btn-done,
        .swagger-ui .auth-wrapper .auth-container .auth-btn-wrapper .btn-cancel {
            background: #4990e2;
            color: white;
        }
    </style>
</head>
<body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.9.0/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '{{openapi_url}}',
        dom_id: '#swagger-ui',
        presets: [
            SwaggerUIBundle.presets.apis,
            SwaggerUIBundle.presets.standalone
        ],
        layout: "BaseLayout",
        deepLinking: true,
        showExtensions: true,
        showCommonExtensions: true,
        defaultModelsExpandDepth: -1,
        displayRequestDuration: true,
        docExpansion: "none",
        operationsSorter: "method",
        filter: true,
        tryItOutEnabled: true,
        persistAuthorization: true,
        supportedSubmitMethods: ["get", "post", "put", "delete", "patch"],
        validatorUrl: null,
        oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
        requestInterceptor: function(request) {
            return request;
        },
        responseInterceptor: function(response) {
            return response;
        },
        onComplete: function() {
            // 自定义授权相关文本
            setTimeout(function() {
                // 替换授权相关的英文文本
                const authElements = document.querySelectorAll('.auth-wrapper');
                authElements.forEach(function(element) {
                    if (element.textContent.includes('Available authorizations')) {
                        element.innerHTML = element.innerHTML.replace(
                            'Available authorizations',
                            '可用的授权方式'
                        );
                    }
                    if (element.textContent.includes('Scopes are used to grant')) {
                        element.innerHTML = element.innerHTML.replace(
                            /Scopes are used to grant.*?Select which ones you want to grant to Swagger UI\./gs,
                            '作用域用于授予应用程序代表最终用户访问数据的不同级别权限。每个API可能声明一个或多个作用域。此API需要以下作用域。请选择您要授予Swagger UI的权限。'
                        );
                    }
                });
                
                // 替换其他常见的英文文本
                const executeButtons = document.querySelectorAll('.btn.execute');
                executeButtons.forEach(function(btn) {
                    if (btn.textContent === 'Execute') {
                        btn.textContent = '执行';
                    }
                });
                
                const tryButtons = document.querySelectorAll('.btn.try-out__btn');
                tryButtons.forEach(function(btn) {
                    if (btn.textContent === 'Try it out') {
                        btn.textContent = '试用';
                    }
                    if (btn.textContent === 'Cancel') {
                        btn.textContent = '取消';
                    }
                });
                
                // 替换授权按钮文本
                const authButtons = document.querySelectorAll('.btn.authorize');
                authButtons.forEach(function(btn) {
                    if (btn.textContent.includes('Authorize')) {
                        btn.textContent = '授权';
                    }
                });
                
                // 替换模型展开文本
                const modelElements = document.querySelectorAll('.model-title');
                modelElements.forEach(function(element) {
                    if (element.textContent.includes('Model')) {
                        element.innerHTML = element.innerHTML.replace('Model', '数据模型');
                    }
                });
                
                // 替换响应相关文本
                const responseElements = document.querySelectorAll('.responses-inner h4');
                responseElements.forEach(function(element) {
                    if (element.textContent === 'Responses') {
                        element.textContent = '响应';
                    }
                });
                
                // 替换参数相关文本
                const paramElements = document.querySelectorAll('.parameters-container .table-container th');
                paramElements.forEach(function(element) {
                    if (element.textContent === 'Name') {
                        element.textContent = '名称';
                    }
                    if (element.textContent === 'Description') {
                        element.textContent = '描述';
                    }
                });
            }, 1000);
            
            // 监听DOM变化，持续替换文本
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        // 重新执行文本替换
                        setTimeout(function() {
                            const executeButtons = document.querySelectorAll('.btn.execute');
                            executeButtons.forEach(function(btn) {
                                if (btn.textContent === 'Execute') {
                                    btn.textContent = '执行';
                                }
                            });
                            
                            const tryButtons = document.querySelectorAll('.btn.try-out__btn');
                            tryButtons.forEach(function(btn) {
                                if (btn.textContent === 'Try it out') {
                                    btn.textContent = '试用';
                                }
                                if (btn.textContent === 'Cancel') {
                                    btn.textContent = '取消';
                                }
                            });
                        }, 100);
                    }
                });
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        }
    });
    </script>
</body>
</html>